{"remainingRequest":"/Users/maguodong/Documents/projects/luffycity/web im/node_modules/babel-loader/lib/index.js!/Users/maguodong/Documents/projects/luffycity/web im/node_modules/eslint-loader/index.js??ref--13-0!/Users/maguodong/Documents/projects/luffycity/web im/src/store/modules/conversation.js","dependencies":[{"path":"/Users/maguodong/Documents/projects/luffycity/web im/src/store/modules/conversation.js","mtime":1576188392000},{"path":"/Users/maguodong/Documents/projects/luffycity/web im/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/maguodong/Documents/projects/luffycity/web im/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/maguodong/Documents/projects/luffycity/web im/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport _toConsumableArray from \"/Users/maguodong/Documents/projects/luffycity/web im/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport tim from 'tim';\nimport TIM from 'tim-js-sdk';\nimport store from '..';\nimport { titleNotify } from \"../../utils\";\nvar conversationModules = {\n  state: {\n    currentConversation: {},\n    currentMessageList: [],\n    nextReqMessageID: '',\n    isCompleted: false,\n    // 当前会话消息列表是否已经拉完了所有消息\n    conversationList: []\n  },\n  getters: {\n    toAccount: function toAccount(state) {\n      if (!state.currentConversation || !state.currentConversation.conversationID) {\n        return '';\n      }\n\n      switch (state.currentConversation.type) {\n        case 'C2C':\n          return state.currentConversation.conversationID.replace('C2C', '');\n\n        case 'GROUP':\n          return state.currentConversation.conversationID.replace('GROUP', '');\n\n        default:\n          return state.currentConversation.conversationID;\n      }\n    },\n    currentConversationType: function currentConversationType(state) {\n      if (!state.currentConversation || !state.currentConversation.type) {\n        return '';\n      }\n\n      return state.currentConversation.type;\n    },\n    totalUnreadCount: function totalUnreadCount(state) {\n      var result = state.conversationList.reduce(function (count, conversation) {\n        // 当前会话不计算总未读\n        if (!store.getters.hidden && state.currentConversation.conversationID === conversation.conversationID) {\n          return count;\n        }\n\n        return count + conversation.unreadCount;\n      }, 0);\n      titleNotify(result);\n      return result;\n    },\n    // 用于当前会话的图片预览\n    imgUrlList: function imgUrlList(state) {\n      return state.currentMessageList.filter(function (message) {\n        return message.type === TIM.TYPES.MSG_IMAGE;\n      }).map(function (message) {\n        return message.payload.imageInfoArray[0].url;\n      });\n    }\n  },\n  mutations: {\n    /**\n     * 更新当前会话\n     * 调用时机: 切换会话时\n     * @param {Object} state\n     * @param {Conversation} conversation\n     */\n    updateCurrentConversation: function updateCurrentConversation(state, conversation) {\n      state.currentConversation = conversation;\n      state.currentMessageList = [];\n      state.nextReqMessageID = '';\n      state.isCompleted = false;\n    },\n\n    /**\n     * 更新会话列表\n     * 调用时机：触发会话列表更新事件时。CONVERSATION_LIST_UPDATED\n     * @param {Object} state\n     * @param {Conversation[]} conversationList\n     */\n    updateConversationList: function updateConversationList(state, conversationList) {\n      state.conversationList = conversationList;\n    },\n\n    /**\n     * 重置当前会话\n     * 调用时机：需要重置当前会话时，例如：当前会话是一个群组，正好被踢出群时（被踢群事件触发），重置当前会话\n     * @param {Object} state\n     */\n    resetCurrentConversation: function resetCurrentConversation(state) {\n      state.currentConversation = {};\n    },\n\n    /**\n     * 将消息插入当前会话列表\n     * 调用时机：收/发消息事件触发时\n     * @param {Object} state\n     * @param {Message[]|Message} data\n     * @returns\n     */\n    pushCurrentMessageList: function pushCurrentMessageList(state, data) {\n      // 还没当前会话，则跳过\n      if (!state.currentConversation.conversationID) {\n        return;\n      }\n\n      if (Array.isArray(data)) {\n        // 筛选出当前会话的消息\n        var result = data.filter(function (item) {\n          return item.conversationID === state.currentConversation.conversationID;\n        });\n        state.currentMessageList = [].concat(_toConsumableArray(state.currentMessageList), _toConsumableArray(result));\n      } else if (data.conversationID === state.currentConversation.conversationID) {\n        state.currentMessageList = [].concat(_toConsumableArray(state.currentMessageList), [data]);\n      }\n    },\n\n    /**\n     * 从当前消息列表中删除某条消息\n     * @param {Object} state\n     * @param {Message} message\n     */\n    removeMessage: function removeMessage(state, message) {\n      var index = state.currentMessageList.findIndex(function (_ref) {\n        var ID = _ref.ID;\n        return ID === message.ID;\n      });\n\n      if (index >= 0) {\n        state.currentMessageList.splice(index, 1);\n      }\n    },\n    reset: function reset(state) {\n      Object.assign(state, {\n        currentConversation: {},\n        currentMessageList: [],\n        nextReqMessageID: '',\n        isCompleted: false,\n        // 当前会话消息列表是否已经拉完了所有消息\n        conversationList: []\n      });\n    }\n  },\n  actions: {\n    /**\n     * 获取消息列表\n     * 调用时机：打开某一会话时或下拉获取历史消息时\n     * @param {Object} context\n     * @param {String} conversationID\n     */\n    getMessageList: function getMessageList(context, conversationID) {\n      if (context.state.isCompleted) {\n        context.commit('showMessage', {\n          message: '已经没有更多的历史消息了哦',\n          type: 'info'\n        });\n        return;\n      }\n\n      var _context$state = context.state,\n          nextReqMessageID = _context$state.nextReqMessageID,\n          currentMessageList = _context$state.currentMessageList;\n      tim.getMessageList({\n        conversationID: conversationID,\n        nextReqMessageID: nextReqMessageID,\n        count: 15\n      }).then(function (imReponse) {\n        // 更新messageID，续拉时要用到\n        context.state.nextReqMessageID = imReponse.data.nextReqMessageID;\n        context.state.isCompleted = imReponse.data.isCompleted; // 更新当前消息列表，从头部插入\n\n        context.state.currentMessageList = [].concat(_toConsumableArray(imReponse.data.messageList), _toConsumableArray(currentMessageList));\n      });\n    },\n\n    /**\n     * 切换会话\n     * 调用时机：切换会话时\n     * @param {Object} context\n     * @param {String} conversationID\n     */\n    checkoutConversation: function checkoutConversation(context, conversationID) {\n      context.commit('resetCurrentMemberList'); // 1.切换会话前，将切换前的会话进行已读上报\n\n      if (context.state.currentConversation.conversationID) {\n        var prevConversationID = context.state.currentConversation.conversationID;\n        tim.setMessageRead({\n          conversationID: prevConversationID\n        });\n      } // 2.待切换的会话也进行已读上报\n\n\n      tim.setMessageRead({\n        conversationID: conversationID\n      }); // 3. 获取会话信息\n\n      return tim.getConversationProfile(conversationID).then(function (_ref2) {\n        var data = _ref2.data;\n        // 3.1 更新当前会话\n        context.commit('updateCurrentConversation', data.conversation); // 3.2 获取消息列表\n\n        context.dispatch('getMessageList', conversationID); // 3.3 拉取第一页群成员列表\n\n        if (data.conversation.type === TIM.TYPES.CONV_GROUP) {\n          return context.dispatch('getGroupMemberList', data.conversation.groupProfile.groupID);\n        }\n\n        return Promise.resolve();\n      });\n    }\n  }\n};\nexport default conversationModules;",{"version":3,"sources":["/Users/maguodong/Documents/projects/luffycity/web im/src/store/modules/conversation.js"],"names":["tim","TIM","store","titleNotify","conversationModules","state","currentConversation","currentMessageList","nextReqMessageID","isCompleted","conversationList","getters","toAccount","conversationID","type","replace","currentConversationType","totalUnreadCount","result","reduce","count","conversation","hidden","unreadCount","imgUrlList","filter","message","TYPES","MSG_IMAGE","map","payload","imageInfoArray","url","mutations","updateCurrentConversation","updateConversationList","resetCurrentConversation","pushCurrentMessageList","data","Array","isArray","item","removeMessage","index","findIndex","ID","splice","reset","Object","assign","actions","getMessageList","context","commit","then","imReponse","messageList","checkoutConversation","prevConversationID","setMessageRead","getConversationProfile","dispatch","CONV_GROUP","groupProfile","groupID","Promise","resolve"],"mappings":"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","sourcesContent":["import tim from 'tim'\nimport TIM from 'tim-js-sdk'\nimport store from '..'\nimport { titleNotify } from '../../utils'\nconst conversationModules = {\n  state: {\n    currentConversation: {},\n    currentMessageList: [],\n    nextReqMessageID: '',\n    isCompleted: false, // 当前会话消息列表是否已经拉完了所有消息\n    conversationList: []\n  },\n  getters: {\n    toAccount: state => {\n      if (!state.currentConversation || !state.currentConversation.conversationID) {\n        return ''\n      }\n      switch (state.currentConversation.type) {\n        case 'C2C':\n          return state.currentConversation.conversationID.replace('C2C', '')\n        case 'GROUP':\n          return state.currentConversation.conversationID.replace('GROUP', '')\n        default:\n          return state.currentConversation.conversationID\n      }\n    },\n    currentConversationType: state => {\n      if (!state.currentConversation || !state.currentConversation.type) {\n        return ''\n      }\n      return state.currentConversation.type\n    },\n    totalUnreadCount: state => {\n      const result = state.conversationList.reduce((count, conversation) => {\n        // 当前会话不计算总未读\n        if (!store.getters.hidden && state.currentConversation.conversationID === conversation.conversationID) {\n          return count\n        }\n        return count + conversation.unreadCount\n      }, 0)\n      titleNotify(result)\n      return result\n    },\n    // 用于当前会话的图片预览\n    imgUrlList: state => {\n      return state.currentMessageList\n        .filter(message => message.type === TIM.TYPES.MSG_IMAGE)\n        .map(message => message.payload.imageInfoArray[0].url)\n    }\n  },\n  mutations: {\n    /**\n     * 更新当前会话\n     * 调用时机: 切换会话时\n     * @param {Object} state\n     * @param {Conversation} conversation\n     */\n    updateCurrentConversation(state, conversation) {\n      state.currentConversation = conversation\n      state.currentMessageList = []\n      state.nextReqMessageID = ''\n      state.isCompleted = false\n    },\n    /**\n     * 更新会话列表\n     * 调用时机：触发会话列表更新事件时。CONVERSATION_LIST_UPDATED\n     * @param {Object} state\n     * @param {Conversation[]} conversationList\n     */\n    updateConversationList(state, conversationList) {\n      state.conversationList = conversationList\n    },\n    /**\n     * 重置当前会话\n     * 调用时机：需要重置当前会话时，例如：当前会话是一个群组，正好被踢出群时（被踢群事件触发），重置当前会话\n     * @param {Object} state\n     */\n    resetCurrentConversation(state) {\n      state.currentConversation = {}\n    },\n    /**\n     * 将消息插入当前会话列表\n     * 调用时机：收/发消息事件触发时\n     * @param {Object} state\n     * @param {Message[]|Message} data\n     * @returns\n     */\n    pushCurrentMessageList(state, data) {\n      // 还没当前会话，则跳过\n      if (!state.currentConversation.conversationID) {\n        return\n      }\n      if (Array.isArray(data)) {\n        // 筛选出当前会话的消息\n        const result = data.filter(item => item.conversationID === state.currentConversation.conversationID)\n        state.currentMessageList = [...state.currentMessageList, ...result]\n      } else if (data.conversationID === state.currentConversation.conversationID) {\n        state.currentMessageList = [...state.currentMessageList, data]\n      }\n    },\n    /**\n     * 从当前消息列表中删除某条消息\n     * @param {Object} state\n     * @param {Message} message\n     */\n    removeMessage(state, message) {\n      const index = state.currentMessageList.findIndex(({ ID }) => ID === message.ID)\n      if (index >= 0) {\n        state.currentMessageList.splice(index, 1)\n      }\n    },\n    reset(state) {\n      Object.assign(state, {\n        currentConversation: {},\n        currentMessageList: [],\n        nextReqMessageID: '',\n        isCompleted: false, // 当前会话消息列表是否已经拉完了所有消息\n        conversationList: []\n      })\n    }\n  },\n  actions: {\n    /**\n     * 获取消息列表\n     * 调用时机：打开某一会话时或下拉获取历史消息时\n     * @param {Object} context\n     * @param {String} conversationID\n     */\n    getMessageList(context, conversationID) {\n      if (context.state.isCompleted) {\n        context.commit('showMessage', {\n          message: '已经没有更多的历史消息了哦',\n          type: 'info'\n        })\n        return\n      }\n      const { nextReqMessageID, currentMessageList } = context.state\n      tim.getMessageList({ conversationID, nextReqMessageID, count: 15 }).then(imReponse => {\n        // 更新messageID，续拉时要用到\n        context.state.nextReqMessageID = imReponse.data.nextReqMessageID\n        context.state.isCompleted = imReponse.data.isCompleted\n        // 更新当前消息列表，从头部插入\n        context.state.currentMessageList = [...imReponse.data.messageList, ...currentMessageList]\n      })\n    },\n    /**\n     * 切换会话\n     * 调用时机：切换会话时\n     * @param {Object} context\n     * @param {String} conversationID\n     */\n    checkoutConversation(context, conversationID) {\n      context.commit('resetCurrentMemberList')\n      // 1.切换会话前，将切换前的会话进行已读上报\n      if (context.state.currentConversation.conversationID) {\n        const prevConversationID = context.state.currentConversation.conversationID\n        tim.setMessageRead({ conversationID: prevConversationID })\n      }\n      // 2.待切换的会话也进行已读上报\n      tim.setMessageRead({ conversationID })\n      // 3. 获取会话信息\n      return tim.getConversationProfile(conversationID).then(({ data }) => {\n        // 3.1 更新当前会话\n        context.commit('updateCurrentConversation', data.conversation)\n        // 3.2 获取消息列表\n        context.dispatch('getMessageList', conversationID)\n        // 3.3 拉取第一页群成员列表\n        if (data.conversation.type === TIM.TYPES.CONV_GROUP) {\n          return context.dispatch('getGroupMemberList', data.conversation.groupProfile.groupID)\n        }\n        return Promise.resolve()\n      })\n    }\n  }\n}\n\nexport default conversationModules\n"]}]}